.. _installation:

Installation
************

Installation Options Overview
-----------------------------
The user has two different installation options available:

1. Through the use of a setup.py file

2. Through the use of a Docker container image

We recommend most users proceed with option 1 so they may interface with the 
Python code as they would standardly. However, for users who are experienced
with containers, the container provides a more simplified installation route.
CKBIT requires more steps to install than a simple pip command due to the 
complexity of the dependency providing the Bayesian inference capabilities.
We guide the user through these steps below.

--------------------------------------------------------------------------------

Installation Option 1
---------------------

**Steps Overview**

1. Installing Python
2. Installing PyStan
3. Installing CKBIT

**Installing Python**

Anaconda is the recommended method to install Python for scientific 
applications. It is supported on Linux, Windows and Mac OS X. This software 
runs on Python 3.7 and more recent versions. Anaconda can be downloaded here:
https://www.anaconda.com/products/individual#download-section

**Installing PyStan**

PyStan is the Python library that provides the Bayesian inference functionality
for CKBIT, so it is crucial to install it properly. This becomes complicated
since there are multiple versions of PyStan with different installation pathways
depending on whether the computer is running Linux, Windows, or a Mac OS. To run 
CKBIT, **a user must first install PyStan with the CVODES library. Without the
CVODES version of PyStan, CKBIT will not install.** For Windows users, please 
install Anaconda and see below for instructions. For all other users, please 
reference the documentation provided by PyStan on how to install their 
software here: 
https://pystan.readthedocs.io/en/latest/installation_beginner.html

For details on how to get the CVODES version, reference this link:
https://pystan.readthedocs.io/en/latest/installation_cvodes.html

For Windows users with Anaconda, follow these steps:

1. Open the Anaconda prompt application.

2. Ensure you have the necessary dependencies for PyStan: m2w64-toolchain,
numpy, cython, and git. To do this, enter 
::

	conda list
	
into the Anaconda command prompt. The output will be a list of all dependences 
in the current environment. Ensure that all the listed dependencies are present. 
If any are missing, see below. It is also important to confirm that the cython 
version is >=0.22 and the numpy version is >=1.7. If the versions
of these dependencies are out of date, update them by entering the following 
into the Anaconda command prompt (replacing dependency_name with the name of 
the dependency you wish to update):
::

	conda update dependency_name
	
If any of the dependencies are missing from the list, they simply need to be 
installed. The following commands entered into the Anaconda command prompt can 
be used for each dependency:

m2w64-toolchain:
::

	conda install libpython m2w64-toolchain -c msys2

numpy:
::

	conda install -c anaconda numpy 

cython:
::

	conda install -c anaconda cython 
	 
git:
::

	conda install -c anaconda git 

3. The final step is to install the CVODES version of PyStan. Enter the 
following commands into the Anaconda command prompt sequentially hitting 
y for yes when appropriate:
::

	git config --system core.longpaths true
	git clone --recursive https://github.com/stan-dev/pystan 
	cd pystan
	git checkout cvodes
	git submodule update --recursive
	python -c "import os, shutil; [shutil.rmtree(r'\\?\{}'.format(os.path.abspath(dirname)), ignore_errors=True) for dirname in [dirname for dirname, *_ in os.walk('pystan/stan') if any(dirname.endswith(ends) for ends in ['doc', 'test'])]]"
	python -m pip install .

**Installing CKBIT**

Now that the CVODES version of PyStan is installed, the user can now install
CKBIT. Note, once this software is public, we will provide a simpler pathway for
installation through PyPI for users. For now, follow these instructions:   

1. Download the zip file with 
CKBIT.

2. Unzip the files to a known location on your 
machine. 

3. Navigate through these files until you find the folder that contains the
setup.py file. Copy the location of this folder.

4. Open the Anaconda command prompt and navigate to the location of the folder
copied in step 3. This navigation can be performed with the following code 
entered into the Anaconda command prompt with folder_path replaced with the 
copied location from step 3:
::

	cd folder_path
	
5. Input the following code into the Anaconda command prompt:
::

	python setup.py install
	
The user will now be able to run CKBIT as they would any other Python package.

Note: for users interested in writing their data to Excel workbooks, please 
ensure you have the dependency named openpyxl. You can check if you already
have it installed by following the first two steps of the **Installing PyStan**
instructions. If you do not have it, enter this code into the Anaconda
command prompt:
::

	conda install -c anaconda openpyxl

Note: for users interested in making visually appealing distribution plots, 
please ensure you have the dependency named seaborn. You can check if you 
already have it installed by following the first two steps of the 
**Installing PyStan** instructions. If you do not have it, enter this code 
into the Anaconda command prompt:
::

	conda install -c anaconda seaborn

--------------------------------------------------------------------------------

Installation Option 2
---------------------
Once the article is about to be published, the container will be made 
publicly available on Docker Hub. For now, we have a private download
link created for reviewers.

A Docker container image can be accessed at this link:

https://files.ccei.udel.edu/p/ckbit-reviewers/ckbit-container-latest.tar

username:	ckbit-reviewer

password:	!!5-DISCOVERED-EXPERIENCE-determine-PARAGRAPH-6!!

Once you have successfully downloaded the container:

1. Load the image:
::
	
	docker image load --input ckbit-container-latest.tar

2. Start a Python shell inside a container based off of that image:
::

    docker run --rm --interactive --tty ckbit:0.0.1 python3

3. Interface with the Python prompt to run CKBIT
